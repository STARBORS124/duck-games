<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ü¶Ü DUCK GAMES</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #87CEEB 0%, #B0E0E6 100%);
            min-height: 100vh;
            padding: 16px;
            position: relative;
            overflow-x: hidden;
        }

        .bg-emoji {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            font-size: 24px;
            opacity: 0.15;
            animation: float 15s infinite linear;
            user-select: none;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            75% { transform: translateY(20px) rotate(-5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }

        .star-1 { top: 2%; left: 3%; animation-delay: 0s; font-size: 28px; }
        .star-2 { top: 10%; right: 5%; animation-delay: 1s; font-size: 32px; }
        .star-3 { top: 25%; left: 8%; animation-delay: 2s; font-size: 24px; }
        .star-4 { top: 35%; right: 12%; animation-delay: 3s; font-size: 36px; }
        .star-5 { top: 45%; left: 15%; animation-delay: 4s; font-size: 30px; }
        .star-6 { top: 55%; right: 8%; animation-delay: 5s; font-size: 26px; }
        .star-7 { top: 65%; left: 5%; animation-delay: 6s; font-size: 34px; }
        .star-8 { top: 75%; right: 18%; animation-delay: 7s; font-size: 28px; }
        .star-9 { top: 85%; left: 12%; animation-delay: 8s; font-size: 32px; }
        .star-10 { top: 95%; right: 5%; animation-delay: 9s; font-size: 24px; }
        
        .coin-1 { top: 5%; left: 20%; animation-delay: 0.5s; font-size: 32px; }
        .coin-2 { top: 15%; right: 25%; animation-delay: 1.5s; font-size: 28px; }
        .coin-3 { top: 30%; left: 40%; animation-delay: 2.5s; font-size: 36px; }
        .coin-4 { top: 40%; right: 35%; animation-delay: 3.5s; font-size: 30px; }
        .coin-5 { top: 50%; left: 60%; animation-delay: 4.5s; font-size: 26px; }
        .coin-6 { top: 60%; right: 45%; animation-delay: 5.5s; font-size: 34px; }
        .coin-7 { top: 70%; left: 75%; animation-delay: 6.5s; font-size: 28px; }
        .coin-8 { top: 80%; right: 55%; animation-delay: 7.5s; font-size: 32px; }
        .coin-9 { top: 90%; left: 85%; animation-delay: 8.5s; font-size: 24px; }

        .app {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .header {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            border-radius: 28px;
            padding: 16px 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .duck-icon {
            width: 44px;
            height: 44px;
            background: #1E3A8A;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 0 #0F2A5A;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            color: #1E3A8A;
            text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.5);
        }

        .balance-box {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(5px);
            border-radius: 40px;
            padding: 8px 16px;
            border: 2px solid #1E3A8A;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .balance-box.sync {
            border-color: #4CAF50;
            box-shadow: 0 0 20px #4CAF50;
            transform: scale(1.02);
        }

        .star-icon {
            font-size: 20px;
            color: #1E3A8A;
        }

        .balance-num {
            font-size: 22px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .balance-label {
            font-size: 12px;
            color: #1E3A8A;
            opacity: 0.8;
        }

        .global-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }

        .global-stat-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 12px 4px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.05);
        }

        .global-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .global-stat-label {
            font-size: 10px;
            color: #1E3A8A;
            opacity: 0.8;
            margin-top: 4px;
        }

        .menu-title {
            font-size: 18px;
            color: #1E3A8A;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .menu-title::before {
            content: 'ü¶Ü';
            font-size: 22px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px 16px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .game-card:hover {
            border-color: #1E3A8A;
            transform: translateY(-4px);
            box-shadow: 0 10px 0 rgba(0, 0, 0, 0.1);
        }

        .card-emoji {
            font-size: 56px;
            margin-bottom: 12px;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1));
        }

        .card-name {
            font-size: 20px;
            font-weight: 700;
            color: #1E3A8A;
            margin-bottom: 4px;
        }

        .card-stats {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
            font-size: 12px;
        }

        .card-stat {
            background: rgba(255, 255, 255, 0.5);
            padding: 4px 10px;
            border-radius: 20px;
            color: #1E3A8A;
            font-weight: 600;
        }

        .game-menu {
            display: none;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 28px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.1);
        }

        .game-menu-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
        }

        .game-menu-emoji {
            font-size: 48px;
            background: rgba(255, 255, 255, 0.4);
            width: 80px;
            height: 80px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1E3A8A;
        }

        .game-menu-info h2 {
            font-size: 28px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .game-menu-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .game-menu-stat {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 16px;
            padding: 12px 4px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .stat-label {
            font-size: 10px;
            color: #1E3A8A;
            opacity: 0.8;
        }

        .game-menu-buttons {
            display: flex;
            gap: 12px;
        }

        .menu-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-btn.play {
            background: #1E3A8A;
            color: white;
            box-shadow: 0 6px 0 #0F2A5A;
        }

        .menu-btn.play:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #0F2A5A;
        }

        .menu-btn.back {
            background: rgba(255, 255, 255, 0.5);
            color: #1E3A8A;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
        }

        .game-play-area {
            display: none;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 28px;
            padding: 24px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.1);
        }

        .play-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .play-title {
            font-size: 24px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .play-balance {
            background: rgba(255, 255, 255, 0.5);
            padding: 8px 16px;
            border-radius: 40px;
            border: 1px solid #1E3A8A;
            color: #1E3A8A;
            font-weight: 600;
        }

        .slots-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .slot-cell {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 24px;
            padding: 24px 8px;
            font-size: 48px;
            text-align: center;
            border: 2px solid #1E3A8A;
            box-shadow: inset 0 -4px 0 #0F2A5A;
        }

        .dice-display {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .dice-box {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            border: 3px solid #1E3A8A;
            box-shadow: 0 8px 0 #0F2A5A;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .choice-btn {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid #1E3A8A;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 700;
            color: #1E3A8A;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #0F2A5A;
        }

        .choice-btn.selected {
            background: #1E3A8A;
            color: white;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #0F2A5A;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .case-item {
            aspect-ratio: 1;
            background: #1E3A8A;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid #0F2A5A;
            box-shadow: 0 6px 0 #0A1F3F;
            color: white;
            font-weight: bold;
        }

        .case-item.opened {
            background: rgba(255, 255, 255, 0.5);
            border-color: #1E3A8A;
            box-shadow: 0 4px 0 #0F2A5A;
            color: #1E3A8A;
        }

        .bet-field {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid #1E3A8A;
            border-radius: 40px;
            font-size: 20px;
            text-align: center;
            font-weight: 600;
            color: #1E3A8A;
            margin: 15px 0;
        }

        .game-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .game-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .game-btn.primary {
            background: #1E3A8A;
            color: white;
            box-shadow: 0 6px 0 #0F2A5A;
        }

        .game-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #0F2A5A;
        }

        .game-btn.secondary {
            background: rgba(255, 255, 255, 0.5);
            color: #1E3A8A;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
        }

        .game-result {
            margin-top: 16px;
            padding: 16px;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            animation: resultPop 0.3s;
        }

        .win-result {
            background: rgba(76, 175, 80, 0.2);
            color: #2E7D32;
            border: 2px solid #4CAF50;
        }

        .lose-result {
            background: rgba(244, 67, 54, 0.2);
            color: #C62828;
            border: 2px solid #F44336;
        }

        .error-msg {
            background: rgba(244, 67, 54, 0.2);
            color: #C62828;
            padding: 14px;
            border-radius: 40px;
            margin: 10px 0;
            border: 2px solid #F44336;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #1E3A8A;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="bg-emoji star-1">‚≠êÔ∏è</div>
    <div class="bg-emoji star-2">üåü</div>
    <div class="bg-emoji star-3">‚ú®</div>
    <div class="bg-emoji star-4">‚≠êÔ∏è</div>
    <div class="bg-emoji star-5">üåü</div>
    <div class="bg-emoji star-6">‚ú®</div>
    <div class="bg-emoji star-7">‚≠êÔ∏è</div>
    <div class="bg-emoji star-8">üåü</div>
    <div class="bg-emoji star-9">‚ú®</div>
    <div class="bg-emoji star-10">‚≠êÔ∏è</div>
    <div class="bg-emoji coin-1">ü™ô</div>
    <div class="bg-emoji coin-2">üí∞</div>
    <div class="bg-emoji coin-3">ü™ô</div>
    <div class="bg-emoji coin-4">üíé</div>
    <div class="bg-emoji coin-5">ü™ô</div>
    <div class="bg-emoji coin-6">üí∞</div>
    <div class="bg-emoji coin-7">ü™ô</div>
    <div class="bg-emoji coin-8">üíé</div>
    <div class="bg-emoji coin-9">üí∞</div>

    <div class="app">
        <div class="header">
            <div class="header-top">
                <div class="logo-area">
                    <div class="duck-icon">ü¶Ü</div>
                    <div class="logo-text">DUCK GAMES</div>
                </div>
                <div class="balance-box" id="balanceBox">
                    <span class="star-icon">‚≠êÔ∏è</span>
                    <span class="balance-num" id="balanceDisplay">0</span>
                    <span class="balance-label">STARS</span>
                </div>
            </div>
        </div>

        <div id="mainMenu">
            <div class="global-stats" id="globalStats">
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalPlays">0</div>
                    <div class="global-stat-label">–í–°–ï–ì–û –ò–ì–†</div>
                </div>
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalWins">0</div>
                    <div class="global-stat-label">–ü–û–ë–ï–î</div>
                </div>
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalWinRate">0%</div>
                    <div class="global-stat-label">–í–ò–ù–†–ï–ô–¢</div>
                </div>
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalBank">0</div>
                    <div class="global-stat-label">–ë–ê–ù–ö‚≠êÔ∏è</div>
                </div>
            </div>

            <div class="menu-title">–í—ã–±–µ—Ä–∏ –∏–≥—Ä—É</div>

            <div class="games-grid">
                <div class="game-card" onclick="showGameMenu('slots')">
                    <div class="card-emoji">üé∞</div>
                    <div class="card-name">–°–ª–æ—Ç—ã</div>
                    <div class="card-stats">
                        <span class="card-stat" id="slotsGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
                <div class="game-card" onclick="showGameMenu('dice')">
                    <div class="card-emoji">üé≤</div>
                    <div class="card-name">–ö–æ—Å—Ç–∏</div>
                    <div class="card-stats">
                        <span class="card-stat" id="diceGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
                <div class="game-card" onclick="showGameMenu('coin')">
                    <div class="card-emoji">ü™ô</div>
                    <div class="card-name">–û—Ä—ë–ª/–†–µ—à–∫–∞</div>
                    <div class="card-stats">
                        <span class="card-stat" id="coinGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
                <div class="game-card" onclick="showGameMenu('cases')">
                    <div class="card-emoji">üéÅ</div>
                    <div class="card-name">–ö–µ–π—Å—ã</div>
                    <div class="card-stats">
                        <span class="card-stat" id="casesGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="gameMenu" class="game-menu"></div>
        <div id="gamePlay" class="game-play-area"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        const userId = tg.initDataUnsafe?.user?.id;
        alert('1. User ID: ' + (userId || '–Ω–µ –ø–æ–ª—É—á–µ–Ω'));
        
        if (!userId) {
            alert('2. –û—à–∏–±–∫–∞: –Ω–µ—Ç User ID! –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –Ω–µ —á–µ—Ä–µ–∑ Telegram?');
        }

        let currentGame = '';
        let selectedChoice = null;
        let userBalance = 0;
        let syncInterval = null;
        let globalStats = {};
        let userStats = {};

        // –í–ê–ñ–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å!
        const API_URL = '/api/game';
        alert('3. URL API: ' + API_URL);

        async function sendToBot(action, data = {}) {
            alert('4. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ' + action);
            
            if (!userId) {
                alert('5. –û—à–∏–±–∫–∞: –Ω–µ—Ç User ID');
                return { success: false, message: '–ù–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏' };
            }

            try {
                alert('6. URL –¥–ª—è fetch: ' + API_URL);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        action: action,
                        ...data
                    })
                });

                alert('7. –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ' + response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                alert('8. –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: ' + JSON.stringify(result).substring(0, 100));
                return result;
            } catch (error) {
                alert('9. –û—à–∏–±–∫–∞: ' + error.message);
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è' };
            }
        }

        async function getBalance() {
            alert('10. –í—ã–∑–æ–≤ getBalance');
            
            if (!userId) {
                alert('11. –ù–µ—Ç User ID');
                return;
            }
            
            alert('12. –û—Ç–ø—Ä–∞–≤–∫–∞ get_balance');
            const result = await sendToBot('get_balance');
            alert('13. –†–µ–∑—É–ª—å—Ç–∞—Ç get_balance: ' + JSON.stringify(result));
            
            if (result?.success) {
                userBalance = result.balance;
                document.getElementById('balanceDisplay').textContent = userBalance;
                alert('14. –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ' + userBalance);
                if (result.global_stats) updateGlobalStats(result.global_stats);
                if (result.user_stats) userStats = result.user_stats;
            } else {
                alert('15. –û—à–∏–±–∫–∞: ' + (result?.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
        }

        function updateGlobalStats(stats) {
            globalStats = stats;
            let totalPlays = 0, totalWins = 0, totalBank = 0;
            
            for (let game in stats) {
                totalPlays += stats[game].total_plays || 0;
                totalWins += stats[game].total_wins || 0;
                totalBank += stats[game].total_won || 0;
                const elem = document.getElementById(`${game}Global`);
                if (elem) elem.textContent = `‚ö°Ô∏è ${stats[game].total_plays || 0}`;
            }
            
            const winRate = totalPlays > 0 ? Math.round((totalWins / totalPlays) * 100) : 0;
            document.getElementById('globalPlays').textContent = totalPlays;
            document.getElementById('globalWins').textContent = totalWins;
            document.getElementById('globalWinRate').textContent = winRate + '%';
            document.getElementById('globalBank').textContent = totalBank;
        }

        function showGameMenu(game) {
            currentGame = game;
            const titles = { slots: 'üé∞', dice: 'üé≤', coin: 'ü™ô', cases: 'üéÅ' };
            const stats = userStats[game] || { played: 0, won: 0, total_won: 0, total_bet: 0 };
            const played = stats.played || 0;
            const won = stats.won || 0;
            const winRate = played > 0 ? Math.round((won / played) * 100) : 0;
            const profit = (stats.total_won || 0) - (stats.total_bet || 0);

            document.getElementById('gameMenu').innerHTML = `
                <div class="game-menu-header">
                    <div class="game-menu-emoji">${titles[game]}</div>
                    <div class="game-menu-info"><h2>${game}</h2></div>
                </div>
                <div class="game-menu-stats">
                    <div class="game-menu-stat"><div class="stat-value">${played}</div><div class="stat-label">–ò–ì–†</div></div>
                    <div class="game-menu-stat"><div class="stat-value">${won}</div><div class="stat-label">–ü–û–ë–ï–î</div></div>
                    <div class="game-menu-stat"><div class="stat-value">${winRate}%</div><div class="stat-label">–í–ò–ù–†–ï–ô–¢</div></div>
                    <div class="game-menu-stat"><div class="stat-value">${profit >= 0 ? '+' : ''}${profit}</div><div class="stat-label">–ü–†–û–§–ò–¢</div></div>
                </div>
                <div class="game-menu-buttons">
                    <button class="menu-btn play" onclick="startGame('${game}')">–ò–≥—Ä–∞—Ç—å</button>
                    <button class="menu-btn back" onclick="backToMainMenu()">–ù–∞–∑–∞–¥</button>
                </div>
            `;
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameMenu').style.display = 'block';
            document.getElementById('gamePlay').style.display = 'none';
            getBalance();
        }

        function startGame(game) {
            currentGame = game;
            const templates = {
                slots: `
                    <div class="play-header">
                        <div class="play-title">üé∞ –°–ª–æ—Ç—ã</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="slots-display" id="slotsDisplay">
                        <div class="slot-cell">‚ùì</div><div class="slot-cell">‚ùì</div><div class="slot-cell">‚ùì</div>
                    </div>
                    <input type="number" class="bet-field" id="betAmount" min="5" max="100" value="10" step="5">
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn primary" onclick="playSlots()">–ö—Ä—É—Ç–∏—Ç—å</button>
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `,
                dice: `
                    <div class="play-header">
                        <div class="play-title">üé≤ –ö–æ—Å—Ç–∏</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="dice-display"><div class="dice-box" id="diceResult">üé≤</div></div>
                    <div class="choice-grid">
                        <button class="choice-btn" onclick="selectChoice(1)">1</button>
                        <button class="choice-btn" onclick="selectChoice(2)">2</button>
                        <button class="choice-btn" onclick="selectChoice(3)">3</button>
                        <button class="choice-btn" onclick="selectChoice(4)">4</button>
                        <button class="choice-btn" onclick="selectChoice(5)">5</button>
                        <button class="choice-btn" onclick="selectChoice(6)">6</button>
                    </div>
                    <input type="number" class="bet-field" id="betAmount" min="1" max="50" value="5" step="1">
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn primary" onclick="playDice()">–ë—Ä–æ—Å–∏—Ç—å</button>
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `,
                coin: `
                    <div class="play-header">
                        <div class="play-title">ü™ô –û—Ä—ë–ª/–†–µ—à–∫–∞</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="dice-display"><div class="dice-box" id="coinResult">ü™ô</div></div>
                    <div class="choice-grid" style="grid-template-columns: repeat(2,1fr);">
                        <button class="choice-btn" onclick="selectChoice('orel')">ü¶Ö</button>
                        <button class="choice-btn" onclick="selectChoice('reshka')">üí∞</button>
                    </div>
                    <input type="number" class="bet-field" id="betAmount" min="1" max="100" value="5" step="1">
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn primary" onclick="playCoin()">–ë—Ä–æ—Å–∏—Ç—å</button>
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `,
                cases: `
                    <div class="play-header">
                        <div class="play-title">üéÅ –ö–µ–π—Å—ã</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="cases-grid" id="casesGrid">
                        <div class="case-item" onclick="openCase(1)">‚ùì</div>
                        <div class="case-item" onclick="openCase(2)">‚ùì</div>
                        <div class="case-item" onclick="openCase(3)">‚ùì</div>
                    </div>
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `
            };
            document.getElementById('gamePlay').innerHTML = templates[game];
            document.getElementById('gameMenu').style.display = 'none';
            document.getElementById('gamePlay').style.display = 'block';
            selectedChoice = null;
            getBalance();
        }

        function selectChoice(choice) {
            selectedChoice = choice;
            document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        async function playSlots() {
            const bet = parseInt(document.getElementById('betAmount').value);
            if (bet > userBalance) return showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
            const result = await sendToBot('slots', { bet });
            if (result?.success) {
                userBalance = result.new_balance;
                document.getElementById('balanceDisplay').textContent = userBalance;
                document.getElementById('playBalance').textContent = userBalance;
                if (result.slots) {
                    document.querySelectorAll('.slot-cell').forEach((el, i) => {
                        el.textContent = result.slots[i];
                    });
                }
                const resultDiv = document.getElementById('gameResult');
                resultDiv.className = `game-result ${result.win ? 'win-result' : 'lose-result'}`;
                resultDiv.textContent = result.win ? `üéâ +${result.win_amount} ‚≠êÔ∏è` : '‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à';
                await getBalance();
            }
        }

        async function playDice() {
            if (!selectedChoice) return showError('–í—ã–±–µ—Ä–∏ —á–∏—Å–ª–æ!');
            const bet = parseInt(document.getElementById('betAmount').value);
            if (bet > userBalance) return showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
            const result = await sendToBot('dice', { bet, choice: selectedChoice });
            if (result?.success) {
                userBalance = result.new_balance;
                document.getElementById('balanceDisplay').textContent = userBalance;
                document.getElementById('playBalance').textContent = userBalance;
                document.getElementById('diceResult').textContent = result.dice_value;
                const resultDiv = document.getElementById('gameResult');
                resultDiv.className = `game-result ${result.win ? 'win-result' : 'lose-result'}`;
                resultDiv.textContent = result.win ? `üéâ +${result.win_amount} ‚≠êÔ∏è` : '‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à';
                await getBalance();
            }
        }

        async function playCoin() {
            if (!selectedChoice) return showError('–í—ã–±–µ—Ä–∏ —Å—Ç–æ—Ä–æ–Ω—É!');
            const bet = parseInt(document.getElementById('betAmount').value);
            if (bet > userBalance) return showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
            const result = await sendToBot('coin', { bet, choice: selectedChoice });
            if (result?.success) {
                userBalance = result.new_balance;
                document.getElementById('balanceDisplay').textContent = userBalance;
                document.getElementById('playBalance').textContent = userBalance;
                document.getElementById('coinResult').textContent = result.coin_value === 'orel' ? 'ü¶Ö' : 'üí∞';
                const resultDiv = document.getElementById('gameResult');
                resultDiv.className = `game-result ${result.win ? 'win-result' : 'lose-result'}`;
                resultDiv.textContent = result.win ? `üéâ +${result.win_amount} ‚≠êÔ∏è` : '‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à';
                await getBalance();
            }
        }

        async function openCase(caseNum) {
            if (userBalance < 10) return showError('–ù—É–∂–Ω–æ 10 ‚≠êÔ∏è');
            const result = await sendToBot('case', { case: caseNum });
            if (result?.success) {
                userBalance = result.new_balance;
                document.getElementById('balanceDisplay').textContent = userBalance;
                document.getElementById('playBalance').textContent = userBalance;
                event.target.textContent = result.prize;
                event.target.classList.add('opened');
                event.target.onclick = null;
                document.getElementById('gameResult').className = 'game-result win-result';
                document.getElementById('gameResult').textContent = `üéâ +${result.prize} ‚≠êÔ∏è`;
                await getBalance();
            }
        }

        function showError(text) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-msg';
            errorDiv.textContent = text;
            document.getElementById('gamePlay').appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 3000);
        }

        function backToMainMenu() {
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('gameMenu').style.display = 'none';
            document.getElementById('gamePlay').style.display = 'none';
        }

        function backToGameMenu() {
            if (currentGame) showGameMenu(currentGame);
            else backToMainMenu();
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        setTimeout(() => {
            getBalance();
        }, 1000);
        
        setInterval(getBalance, 3000);
    </script>
</body>
</html>
