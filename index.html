<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ü¶Ü DUCK GAMES</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #87CEEB 0%, #B0E0E6 100%);
            min-height: 100vh;
            padding: 16px;
            position: relative;
            overflow-x: hidden;
        }

        /* –§–æ–Ω–æ–≤—ã–µ —ç–º–æ–¥–∑–∏ - —Ç–æ–ª—å–∫–æ –∑–≤–µ–∑–¥—ã –∏ –º–æ–Ω–µ—Ç–∫–∏ */
        .bg-emoji {
            position: fixed;
            pointer-events: none;
            z-index: 0;
            font-size: 24px;
            opacity: 0.15;
            animation: float 15s infinite linear;
            user-select: none;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            75% { transform: translateY(20px) rotate(-5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }

        /* –ó–≤–µ–∑–¥–æ—á–∫–∏ */
        .star-1 { top: 2%; left: 3%; animation-delay: 0s; font-size: 28px; }
        .star-2 { top: 10%; right: 5%; animation-delay: 1s; font-size: 32px; }
        .star-3 { top: 25%; left: 8%; animation-delay: 2s; font-size: 24px; }
        .star-4 { top: 35%; right: 12%; animation-delay: 3s; font-size: 36px; }
        .star-5 { top: 45%; left: 15%; animation-delay: 4s; font-size: 30px; }
        .star-6 { top: 55%; right: 8%; animation-delay: 5s; font-size: 26px; }
        .star-7 { top: 65%; left: 5%; animation-delay: 6s; font-size: 34px; }
        .star-8 { top: 75%; right: 18%; animation-delay: 7s; font-size: 28px; }
        .star-9 { top: 85%; left: 12%; animation-delay: 8s; font-size: 32px; }
        .star-10 { top: 95%; right: 5%; animation-delay: 9s; font-size: 24px; }
        
        /* –ú–æ–Ω–µ—Ç–∫–∏ */
        .coin-1 { top: 5%; left: 20%; animation-delay: 0.5s; font-size: 32px; }
        .coin-2 { top: 15%; right: 25%; animation-delay: 1.5s; font-size: 28px; }
        .coin-3 { top: 30%; left: 40%; animation-delay: 2.5s; font-size: 36px; }
        .coin-4 { top: 40%; right: 35%; animation-delay: 3.5s; font-size: 30px; }
        .coin-5 { top: 50%; left: 60%; animation-delay: 4.5s; font-size: 26px; }
        .coin-6 { top: 60%; right: 45%; animation-delay: 5.5s; font-size: 34px; }
        .coin-7 { top: 70%; left: 75%; animation-delay: 6.5s; font-size: 28px; }
        .coin-8 { top: 80%; right: 55%; animation-delay: 7.5s; font-size: 32px; }
        .coin-9 { top: 90%; left: 85%; animation-delay: 8.5s; font-size: 24px; }

        .app {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .header {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 28px;
            padding: 16px 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.1), 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .duck-icon {
            width: 44px;
            height: 44px;
            background: #1E3A8A;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 0 #0F2A5A;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            color: #1E3A8A;
            text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.5);
        }

        .balance-box {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(5px);
            border-radius: 40px;
            padding: 8px 16px;
            border: 2px solid #1E3A8A;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .balance-box.sync {
            border-color: #4CAF50;
            box-shadow: 0 0 20px #4CAF50;
            transform: scale(1.02);
        }

        .star-icon {
            font-size: 20px;
            color: #1E3A8A;
        }

        .balance-num {
            font-size: 22px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .balance-label {
            font-size: 12px;
            color: #1E3A8A;
            opacity: 0.8;
        }

        .global-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }

        .global-stat-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 12px 4px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.05);
        }

        .global-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .global-stat-label {
            font-size: 10px;
            color: #1E3A8A;
            opacity: 0.8;
            margin-top: 4px;
        }

        .menu-title {
            font-size: 18px;
            color: #1E3A8A;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .menu-title::before {
            content: 'ü¶Ü';
            font-size: 22px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px 16px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .game-card:hover {
            border-color: #1E3A8A;
            transform: translateY(-4px);
            box-shadow: 0 10px 0 rgba(0, 0, 0, 0.1);
        }

        .card-emoji {
            font-size: 56px;
            margin-bottom: 12px;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1));
        }

        .card-name {
            font-size: 20px;
            font-weight: 700;
            color: #1E3A8A;
            margin-bottom: 4px;
        }

        .card-stats {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
            font-size: 12px;
        }

        .card-stat {
            background: rgba(255, 255, 255, 0.5);
            padding: 4px 10px;
            border-radius: 20px;
            color: #1E3A8A;
            font-weight: 600;
        }

        .game-menu {
            display: none;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 28px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.1);
        }

        .game-menu-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
        }

        .game-menu-emoji {
            font-size: 48px;
            background: rgba(255, 255, 255, 0.4);
            width: 80px;
            height: 80px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1E3A8A;
        }

        .game-menu-info h2 {
            font-size: 28px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .game-menu-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .game-menu-stat {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 16px;
            padding: 12px 4px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .stat-label {
            font-size: 10px;
            color: #1E3A8A;
            opacity: 0.8;
        }

        .game-menu-history {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .history-title {
            font-size: 16px;
            color: #1E3A8A;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            font-size: 14px;
        }

        .history-win { color: #2E7D32; font-weight: 600; }
        .history-lose { color: #C62828; font-weight: 600; }

        .history-amount-win {
            background: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .history-amount-lose {
            background: #F44336;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
        }

        .game-menu-buttons {
            display: flex;
            gap: 12px;
        }

        .menu-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(5px);
        }

        .menu-btn.play {
            background: #1E3A8A;
            color: white;
            box-shadow: 0 6px 0 #0F2A5A;
        }

        .menu-btn.play:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #0F2A5A;
        }

        .menu-btn.back {
            background: rgba(255, 255, 255, 0.5);
            color: #1E3A8A;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
        }

        .game-play-area {
            display: none;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(15px);
            border-radius: 28px;
            padding: 24px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 0 rgba(0, 0, 0, 0.1);
        }

        .play-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .play-title {
            font-size: 24px;
            font-weight: 700;
            color: #1E3A8A;
        }

        .play-balance {
            background: rgba(255, 255, 255, 0.5);
            padding: 8px 16px;
            border-radius: 40px;
            border: 1px solid #1E3A8A;
            color: #1E3A8A;
            font-weight: 600;
        }

        .slots-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .slot-cell {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 24px;
            padding: 24px 8px;
            font-size: 48px;
            text-align: center;
            border: 2px solid #1E3A8A;
            box-shadow: inset 0 -4px 0 #0F2A5A;
        }

        .dice-display {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .dice-box {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            border: 3px solid #1E3A8A;
            box-shadow: 0 8px 0 #0F2A5A;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .choice-btn {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid #1E3A8A;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 700;
            color: #1E3A8A;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #0F2A5A;
        }

        .choice-btn.selected {
            background: #1E3A8A;
            color: white;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #0F2A5A;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .case-item {
            aspect-ratio: 1;
            background: #1E3A8A;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid #0F2A5A;
            box-shadow: 0 6px 0 #0A1F3F;
            color: white;
            font-weight: bold;
        }

        .case-item.opened {
            background: rgba(255, 255, 255, 0.5);
            border-color: #1E3A8A;
            box-shadow: 0 4px 0 #0F2A5A;
            color: #1E3A8A;
        }

        .bet-field {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid #1E3A8A;
            border-radius: 40px;
            font-size: 20px;
            text-align: center;
            font-weight: 600;
            color: #1E3A8A;
            margin: 15px 0;
        }

        .bet-field:focus {
            outline: none;
            border-color: #0F2A5A;
        }

        .game-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .game-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .game-btn.primary {
            background: #1E3A8A;
            color: white;
            box-shadow: 0 6px 0 #0F2A5A;
        }

        .game-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #0F2A5A;
        }

        .game-btn.secondary {
            background: rgba(255, 255, 255, 0.5);
            color: #1E3A8A;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.1);
        }

        .game-result {
            margin-top: 16px;
            padding: 16px;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            animation: resultPop 0.3s;
        }

        @keyframes resultPop {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .win-result {
            background: rgba(76, 175, 80, 0.2);
            color: #2E7D32;
            border: 2px solid #4CAF50;
        }

        .lose-result {
            background: rgba(244, 67, 54, 0.2);
            color: #C62828;
            border: 2px solid #F44336;
        }

        .error-msg {
            background: rgba(244, 67, 54, 0.2);
            color: #C62828;
            padding: 14px;
            border-radius: 40px;
            margin: 10px 0;
            border: 2px solid #F44336;
            text-align: center;
            animation: errorShake 0.4s;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .sync-animation {
            animation: syncFlash 0.5s;
        }

        @keyframes syncFlash {
            0% { background-color: rgba(30, 58, 138, 0.1); }
            50% { background-color: rgba(76, 175, 80, 0.2); }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body>
    <!-- –ó–≤–µ–∑–¥–æ—á–∫–∏ –Ω–∞ —Ñ–æ–Ω–µ -->
    <div class="bg-emoji star-1">‚≠êÔ∏è</div>
    <div class="bg-emoji star-2">üåü</div>
    <div class="bg-emoji star-3">‚ú®</div>
    <div class="bg-emoji star-4">‚≠êÔ∏è</div>
    <div class="bg-emoji star-5">üåü</div>
    <div class="bg-emoji star-6">‚ú®</div>
    <div class="bg-emoji star-7">‚≠êÔ∏è</div>
    <div class="bg-emoji star-8">üåü</div>
    <div class="bg-emoji star-9">‚ú®</div>
    <div class="bg-emoji star-10">‚≠êÔ∏è</div>

    <!-- –ú–æ–Ω–µ—Ç–∫–∏ –Ω–∞ —Ñ–æ–Ω–µ -->
    <div class="bg-emoji coin-1">ü™ô</div>
    <div class="bg-emoji coin-2">üí∞</div>
    <div class="bg-emoji coin-3">ü™ô</div>
    <div class="bg-emoji coin-4">üíé</div>
    <div class="bg-emoji coin-5">ü™ô</div>
    <div class="bg-emoji coin-6">üí∞</div>
    <div class="bg-emoji coin-7">ü™ô</div>
    <div class="bg-emoji coin-8">üíé</div>
    <div class="bg-emoji coin-9">üí∞</div>

    <div class="app">
        <div class="header">
            <div class="header-top">
                <div class="logo-area">
                    <div class="duck-icon">ü¶Ü</div>
                    <div class="logo-text">DUCK GAMES</div>
                </div>
                <div class="balance-box" id="balanceBox">
                    <span class="star-icon">‚≠êÔ∏è</span>
                    <span class="balance-num" id="balanceDisplay">0</span>
                    <span class="balance-label">STARS</span>
                </div>
            </div>
        </div>

        <div id="mainMenu">
            <div class="global-stats" id="globalStats">
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalPlays">0</div>
                    <div class="global-stat-label">–í–°–ï–ì–û –ò–ì–†</div>
                </div>
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalWins">0</div>
                    <div class="global-stat-label">–ü–û–ë–ï–î</div>
                </div>
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalWinRate">0%</div>
                    <div class="global-stat-label">–í–ò–ù–†–ï–ô–¢</div>
                </div>
                <div class="global-stat-card">
                    <div class="global-stat-value" id="globalBank">0</div>
                    <div class="global-stat-label">–ë–ê–ù–ö‚≠êÔ∏è</div>
                </div>
            </div>

            <div class="menu-title">–í—ã–±–µ—Ä–∏ –∏–≥—Ä—É</div>

            <div class="games-grid">
                <div class="game-card" onclick="showGameMenu('slots')">
                    <div class="card-emoji">üé∞</div>
                    <div class="card-name">–°–ª–æ—Ç—ã</div>
                    <div class="card-stats">
                        <span class="card-stat" id="slotsGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
                <div class="game-card" onclick="showGameMenu('dice')">
                    <div class="card-emoji">üé≤</div>
                    <div class="card-name">–ö–æ—Å—Ç–∏</div>
                    <div class="card-stats">
                        <span class="card-stat" id="diceGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
                <div class="game-card" onclick="showGameMenu('coin')">
                    <div class="card-emoji">ü™ô</div>
                    <div class="card-name">–û—Ä—ë–ª/–†–µ—à–∫–∞</div>
                    <div class="card-stats">
                        <span class="card-stat" id="coinGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
                <div class="game-card" onclick="showGameMenu('cases')">
                    <div class="card-emoji">üéÅ</div>
                    <div class="card-name">–ö–µ–π—Å—ã</div>
                    <div class="card-stats">
                        <span class="card-stat" id="casesGlobal">‚ö°Ô∏è 0</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="gameMenu" class="game-menu"></div>
        <div id="gamePlay" class="game-play-area"></div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        let userId = tg.initDataUnsafe?.user?.id;
        let currentGame = '';
        let selectedChoice = null;
        let userBalance = 0;
        let syncInterval = null;
        let globalStats = {};
        let userStats = {};
        let syncInProgress = false;
        let retryCount = 0;
        const MAX_RETRIES = 5;

        tg.expand();

        // ===== –§–£–ù–ö–¶–ò–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ë–ê–õ–ê–ù–°–ê =====
        async function fetchBalance() {
            if (!userId) {
                console.log('‚ùå –ù–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return null;
            }
            
            try {
                console.log('üîÑ –ó–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞...');
                const response = await fetch(`/api/balance?user_id=${userId}&t=${Date.now()}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üì¶ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:', data);
                return data;
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
                return null;
            }
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–õ–ê–ù–°–ê =====
        async function initializeBalance() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞...');
            const data = await fetchBalance();
            
            if (data && data.success) {
                userBalance = data.balance;
                console.log('üí∞ –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:', userBalance);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –±–∞–ª–∞–Ω—Å–æ–º
                updateAllBalances();
                
                if (data.global_stats) {
                    updateGlobalStats(data.global_stats);
                }
                
                if (data.user_stats) {
                    userStats = data.user_stats;
                }
                
                retryCount = 0;
                return true;
            } else {
                console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å, –ø–æ–ø—ã—Ç–∫–∞', retryCount + 1);
                retryCount++;
                
                if (retryCount < MAX_RETRIES) {
                    setTimeout(initializeBalance, 1000 * retryCount);
                }
                return false;
            }
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–°–ï–• –≠–õ–ï–ú–ï–ù–¢–û–í –° –ë–ê–õ–ê–ù–°–û–ú =====
        function updateAllBalances() {
            const balanceDisplay = document.getElementById('balanceDisplay');
            if (balanceDisplay) {
                balanceDisplay.textContent = userBalance;
            }
            
            const playBalance = document.getElementById('playBalance');
            if (playBalance) {
                playBalance.textContent = userBalance;
            }
        }

        // ===== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ë–ê–õ–ê–ù–°–ê =====
        async function syncBalance() {
            if (!userId) return;
            if (syncInProgress) return;
            
            syncInProgress = true;
            
            try {
                const data = await fetchBalance();
                
                if (data && data.success) {
                    const oldBalance = userBalance;
                    userBalance = data.balance;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    updateAllBalances();
                    
                    console.log('üí∞ –ë–∞–ª–∞–Ω—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω:', oldBalance, '‚Üí', userBalance);
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
                    if (oldBalance !== userBalance) {
                        const balanceBox = document.getElementById('balanceBox');
                        if (balanceBox) {
                            balanceBox.classList.add('sync');
                            setTimeout(() => balanceBox.classList.remove('sync'), 500);
                        }
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    if (data.global_stats) {
                        updateGlobalStats(data.global_stats);
                    }
                    
                    if (data.user_stats) {
                        userStats = data.user_stats;
                        
                        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –º–µ–Ω—é –∏–≥—Ä—ã, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                        if (document.getElementById('gameMenu').style.display === 'block' && currentGame) {
                            refreshGameMenu(currentGame);
                        }
                    }
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
            } finally {
                syncInProgress = false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateGlobalStats(stats) {
            globalStats = stats;
            
            let totalPlays = 0;
            let totalWins = 0;
            let totalBank = 0;
            
            for (let game in stats) {
                totalPlays += stats[game].total_plays || 0;
                totalWins += stats[game].total_wins || 0;
                totalBank += stats[game].total_won || 0;
                
                const elem = document.getElementById(`${game}Global`);
                if (elem) elem.textContent = `‚ö°Ô∏è ${stats[game].total_plays || 0}`;
            }
            
            const winRate = totalPlays > 0 ? Math.round((totalWins / totalPlays) * 100) : 0;
            
            const playsElem = document.getElementById('globalPlays');
            const winsElem = document.getElementById('globalWins');
            const rateElem = document.getElementById('globalWinRate');
            const bankElem = document.getElementById('globalBank');
            
            if (playsElem) playsElem.textContent = totalPlays;
            if (winsElem) winsElem.textContent = totalWins;
            if (rateElem) rateElem.textContent = winRate + '%';
            if (bankElem) bankElem.textContent = totalBank;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é –∏–≥—Ä—ã
        function refreshGameMenu(game) {
            const titles = {
                slots: { emoji: 'üé∞', name: '–°–ª–æ—Ç—ã' },
                dice: { emoji: 'üé≤', name: '–ö–æ—Å—Ç–∏' },
                coin: { emoji: 'ü™ô', name: '–û—Ä—ë–ª/–†–µ—à–∫–∞' },
                cases: { emoji: 'üéÅ', name: '–ö–µ–π—Å—ã' }
            };

            const stats = userStats[game] || { played: 0, won: 0, total_won: 0, total_bet: 0 };
            const played = stats.played || 0;
            const won = stats.won || 0;
            const winRate = played > 0 ? Math.round((won / played) * 100) : 0;
            const profit = (stats.total_won || 0) - (stats.total_bet || 0);

            const menuHtml = `
                <div class="game-menu-header">
                    <div class="game-menu-emoji">${titles[game].emoji}</div>
                    <div class="game-menu-info">
                        <h2>${titles[game].name}</h2>
                    </div>
                </div>
                
                <div class="game-menu-stats">
                    <div class="game-menu-stat">
                        <div class="stat-value">${played}</div>
                        <div class="stat-label">–ò–ì–†</div>
                    </div>
                    <div class="game-menu-stat">
                        <div class="stat-value">${won}</div>
                        <div class="stat-label">–ü–û–ë–ï–î</div>
                    </div>
                    <div class="game-menu-stat">
                        <div class="stat-value">${winRate}%</div>
                        <div class="stat-label">–í–ò–ù–†–ï–ô–¢</div>
                    </div>
                    <div class="game-menu-stat">
                        <div class="stat-value">${profit >= 0 ? '+' : ''}${profit}</div>
                        <div class="stat-label">–ü–†–û–§–ò–¢</div>
                    </div>
                </div>
                
                <div class="game-menu-buttons">
                    <button class="menu-btn play" onclick="startGame('${game}')">–ò–≥—Ä–∞—Ç—å</button>
                    <button class="menu-btn back" onclick="backToMainMenu()">–ù–∞–∑–∞–¥</button>
                </div>
            `;

            document.getElementById('gameMenu').innerHTML = menuHtml;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(text, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#F44336' : '#1E3A8A'};
                color: white;
                padding: 12px 24px;
                border-radius: 40px;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: slideDown 0.3s;
            `;
            notification.textContent = text;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–ï–†–ï–î –ò–ì–†–û–ô
        async function preGameSync() {
            console.log('‚ö†Ô∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –∏–≥—Ä–æ–π');
            await syncBalance();
            return userBalance;
        }

        // –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function startBalanceSync() {
            if (syncInterval) clearInterval(syncInterval);
            syncBalance(); // —Å—Ä–∞–∑—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º
            syncInterval = setInterval(syncBalance, 2000); // –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            console.log('‚úÖ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ (–∏–Ω—Ç–µ—Ä–≤–∞–ª 2 —Å–µ–∫—É–Ω–¥—ã)');
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function stopBalanceSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
                console.log('‚èπ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
            }
        }

        // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
        function showGameMenu(game) {
            currentGame = game;
            refreshGameMenu(game);
            
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameMenu').style.display = 'block';
            document.getElementById('gamePlay').style.display = 'none';
            
            syncBalance(); // –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–†–ò –û–¢–ö–†–´–¢–ò–ò –ú–ï–ù–Æ
        }

        function startGame(game) {
            currentGame = game;
            
            const games = {
                slots: `
                    <div class="play-header">
                        <div class="play-title">üé∞ –°–ª–æ—Ç—ã</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="slots-display" id="slotsDisplay">
                        <div class="slot-cell">‚ùì</div>
                        <div class="slot-cell">‚ùì</div>
                        <div class="slot-cell">‚ùì</div>
                    </div>
                    <input type="number" class="bet-field" id="betAmount" min="5" max="100" value="10" step="5">
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn primary" onclick="playSlots()">–ö—Ä—É—Ç–∏—Ç—å</button>
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `,
                dice: `
                    <div class="play-header">
                        <div class="play-title">üé≤ –ö–æ—Å—Ç–∏</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="dice-display"><div class="dice-box" id="diceResult">üé≤</div></div>
                    <div class="choice-grid">
                        <button class="choice-btn" onclick="selectChoice(1)">1</button>
                        <button class="choice-btn" onclick="selectChoice(2)">2</button>
                        <button class="choice-btn" onclick="selectChoice(3)">3</button>
                        <button class="choice-btn" onclick="selectChoice(4)">4</button>
                        <button class="choice-btn" onclick="selectChoice(5)">5</button>
                        <button class="choice-btn" onclick="selectChoice(6)">6</button>
                    </div>
                    <input type="number" class="bet-field" id="betAmount" min="1" max="50" value="5" step="1">
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn primary" onclick="playDice()">–ë—Ä–æ—Å–∏—Ç—å</button>
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `,
                coin: `
                    <div class="play-header">
                        <div class="play-title">ü™ô –û—Ä—ë–ª/–†–µ—à–∫–∞</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="dice-display"><div class="dice-box" id="coinResult">ü™ô</div></div>
                    <div class="choice-grid" style="grid-template-columns: repeat(2,1fr);">
                        <button class="choice-btn" onclick="selectChoice('orel')">ü¶Ö</button>
                        <button class="choice-btn" onclick="selectChoice('reshka')">üí∞</button>
                    </div>
                    <input type="number" class="bet-field" id="betAmount" min="1" max="100" value="5" step="1">
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn primary" onclick="playCoin()">–ë—Ä–æ—Å–∏—Ç—å</button>
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `,
                cases: `
                    <div class="play-header">
                        <div class="play-title">üéÅ –ö–µ–π—Å—ã</div>
                        <div class="play-balance" id="playBalance">${userBalance}</div>
                    </div>
                    <div class="cases-grid" id="casesGrid">
                        <div class="case-item" onclick="openCase(1)">‚ùì</div>
                        <div class="case-item" onclick="openCase(2)">‚ùì</div>
                        <div class="case-item" onclick="openCase(3)">‚ùì</div>
                    </div>
                    <div class="game-result" id="gameResult"></div>
                    <div class="game-buttons">
                        <button class="game-btn secondary" onclick="backToGameMenu()">–ù–∞–∑–∞–¥</button>
                    </div>
                `
            };

            document.getElementById('gamePlay').innerHTML = games[game];
            document.getElementById('gameMenu').style.display = 'none';
            document.getElementById('gamePlay').style.display = 'block';
            
            selectedChoice = null;
            updateAllBalances(); // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
            syncBalance(); // –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–†–ò –û–¢–ö–†–´–¢–ò–ò –ò–ì–†–´
        }

        function selectChoice(choice) {
            selectedChoice = choice;
            document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function showError(text) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-msg';
            errorDiv.textContent = text;
            
            const container = document.getElementById('gamePlay').style.display === 'block' ? 'gamePlay' : 'gameMenu';
            document.getElementById(container).appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 3000);
        }

        // ===== –ò–ì–†–´ –° –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ô –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ï–ô =====
        async function playSlots() {
            await preGameSync(); // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–ï–†–ï–î –ò–ì–†–û–ô
            
            const betInput = document.getElementById('betAmount');
            if (!betInput) return;
            
            const bet = parseInt(betInput.value);
            
            if (bet > userBalance) {
                showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
                return;
            }
            
            try {
                const response = await fetch('/api/game', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: userId, action: 'slots', bet})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.new_balance;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –±–∞–ª–∞–Ω—Å–æ–º
                    updateAllBalances();
                    
                    if (result.slots) {
                        document.querySelectorAll('.slot-cell').forEach((el, i) => {
                            if (el) el.textContent = result.slots[i];
                        });
                    }
                    
                    const resultDiv = document.getElementById('gameResult');
                    if (resultDiv) {
                        resultDiv.className = `game-result ${result.win ? 'win-result' : 'lose-result'}`;
                        resultDiv.textContent = result.win ? `üéâ +${result.win_amount} ‚≠êÔ∏è` : '‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à';
                    }
                    
                    // –ü–û–ö–ê–ó–´–í–ê–ï–ú –£–í–ï–î–û–ú–õ–ï–ù–ò–ï
                    if (result.win) {
                        showNotification(`+${result.win_amount} ‚≠êÔ∏è`, 'success');
                    }
                    
                    // –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–û–°–õ–ï –ò–ì–†–´
                    await syncBalance();
                } else {
                    showError(result.message || '–û—à–∏–±–∫–∞ –∏–≥—Ä—ã');
                }
            } catch (error) {
                console.error('Game error:', error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        async function playDice() {
            if (!selectedChoice) {
                showError('–í—ã–±–µ—Ä–∏ —á–∏—Å–ª–æ!');
                return;
            }
            
            await preGameSync();
            
            const betInput = document.getElementById('betAmount');
            if (!betInput) return;
            
            const bet = parseInt(betInput.value);
            
            if (bet > userBalance) {
                showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
                return;
            }
            
            try {
                const response = await fetch('/api/game', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: userId, action: 'dice', bet, choice: selectedChoice})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.new_balance;
                    
                    updateAllBalances();
                    
                    const diceResult = document.getElementById('diceResult');
                    if (diceResult && result.dice_value) {
                        diceResult.textContent = result.dice_value;
                    }
                    
                    const resultDiv = document.getElementById('gameResult');
                    if (resultDiv) {
                        resultDiv.className = `game-result ${result.win ? 'win-result' : 'lose-result'}`;
                        resultDiv.textContent = result.win ? `üéâ +${result.win_amount} ‚≠êÔ∏è` : '‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à';
                    }
                    
                    if (result.win) {
                        showNotification(`+${result.win_amount} ‚≠êÔ∏è`, 'success');
                    }
                    
                    await syncBalance();
                } else {
                    showError(result.message || '–û—à–∏–±–∫–∞ –∏–≥—Ä—ã');
                }
            } catch (error) {
                console.error('Game error:', error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        async function playCoin() {
            if (!selectedChoice) {
                showError('–í—ã–±–µ—Ä–∏ —Å—Ç–æ—Ä–æ–Ω—É!');
                return;
            }
            
            await preGameSync();
            
            const betInput = document.getElementById('betAmount');
            if (!betInput) return;
            
            const bet = parseInt(betInput.value);
            
            if (bet > userBalance) {
                showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
                return;
            }
            
            try {
                const response = await fetch('/api/game', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: userId, action: 'coin', bet, choice: selectedChoice})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.new_balance;
                    
                    updateAllBalances();
                    
                    const coinResult = document.getElementById('coinResult');
                    if (coinResult && result.coin_value) {
                        coinResult.textContent = result.coin_value === 'orel' ? 'ü¶Ö' : 'üí∞';
                    }
                    
                    const resultDiv = document.getElementById('gameResult');
                    if (resultDiv) {
                        resultDiv.className = `game-result ${result.win ? 'win-result' : 'lose-result'}`;
                        resultDiv.textContent = result.win ? `üéâ +${result.win_amount} ‚≠êÔ∏è` : '‚ùå –ü—Ä–æ–∏–≥—Ä—ã—à';
                    }
                    
                    if (result.win) {
                        showNotification(`+${result.win_amount} ‚≠êÔ∏è`, 'success');
                    }
                    
                    await syncBalance();
                } else {
                    showError(result.message || '–û—à–∏–±–∫–∞ –∏–≥—Ä—ã');
                }
            } catch (error) {
                console.error('Game error:', error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        async function openCase(caseNum) {
            await preGameSync();
            
            if (userBalance < 10) {
                showError('–ù—É–∂–Ω–æ 10 ‚≠êÔ∏è');
                return;
            }
            
            try {
                const response = await fetch('/api/game', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: userId, action: 'case', case: caseNum})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.new_balance;
                    
                    updateAllBalances();
                    
                    const caseEl = event.target;
                    if (caseEl) {
                        caseEl.textContent = result.prize;
                        caseEl.classList.add('opened');
                        caseEl.onclick = null;
                    }
                    
                    const resultDiv = document.getElementById('gameResult');
                    if (resultDiv) {
                        resultDiv.className = 'game-result win-result';
                        resultDiv.textContent = `üéâ +${result.prize} ‚≠êÔ∏è`;
                    }
                    
                    showNotification(`+${result.prize} ‚≠êÔ∏è`, 'success');
                    await syncBalance();
                } else {
                    showError(result.message || '–û—à–∏–±–∫–∞ –∏–≥—Ä—ã');
                }
            } catch (error) {
                console.error('Game error:', error);
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        }

        function backToMainMenu() {
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('gameMenu').style.display = 'none';
            document.getElementById('gamePlay').style.display = 'none';
            syncBalance();
        }

        function backToGameMenu() {
            if (currentGame) showGameMenu(currentGame);
            else backToMainMenu();
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø - –ø–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å —Å—Ä–∞–∑—É
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
            const initialized = await initializeBalance();
            
            if (initialized) {
                console.log('‚úÖ –ë–∞–ª–∞–Ω—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', userBalance);
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
                startBalanceSync();
            } else {
                console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å');
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–æ—Ç—É', 'error');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from { transform: translate(-50%, -100px); opacity: 0; }
                    to { transform: translate(-50%, 0); opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translate(-50%, 0); opacity: 1; }
                    to { transform: translate(-50%, -100px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });

        // –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
        window.addEventListener('beforeunload', function() {
            stopBalanceSync();
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('üì± –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–Ω–æ–≤–∞ –∞–∫—Ç–∏–≤–Ω–∞, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...');
                syncBalance();
            }
        });
    </script>
</body>
</html>
